[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2025-07-11 23:09:39.528200",
  "module": "TrackerX Live",
  "name": "Sales Order Item Auto Populate Factory Prod id style colour brand",
  "script": "// Client Script for Sales Order (Parent DocType)\n// Script Type: Form\n// Reference Doctype: Sales Order\n\n// Handle child table events for Sales Order Items\nfrappe.ui.form.on('Sales Order Item', {\n    // When Factory Prod ID is selected in child table\n    custom_factory_prod_id: function(frm, cdt, cdn) {\n        let row = locals[cdt][cdn];\n        \n        if (row.custom_factory_prod_id) {\n            // Fetch Factory Prod ID details\n            frappe.call({\n                method: 'frappe.client.get',\n                args: {\n                    doctype: 'Factory Prod Id',\n                    name: row.custom_factory_prod_id\n                },\n                callback: function(r) {\n                    if (r.message) {\n                        // Update the fields with fetched data\n                        frappe.model.set_value(cdt, cdn, 'custom_style', r.message.style || '');\n                        frappe.model.set_value(cdt, cdn, 'custom_colour', r.message.colour || '');\n                        frappe.model.set_value(cdt, cdn, 'custom_brand', r.message.brand || '');\n                        \n                        // Refresh the child table to show updated values\n                        frm.refresh_field('items');\n                    }\n                },\n                error: function(r) {\n                    frappe.msgprint(__('Error fetching Factory Prod ID details'));\n                }\n            });\n        } else {\n            // Clear the fields if no Factory Prod ID is selected\n            frappe.model.set_value(cdt, cdn, 'custom_style', '');\n            frappe.model.set_value(cdt, cdn, 'custom_colour', '');\n            frappe.model.set_value(cdt, cdn, 'custom_brand', '');\n            frm.refresh_field('items');\n        }\n    },\n    \n    // Clear related fields when a new row is added\n    items_add: function(frm, cdt, cdn) {\n        frappe.model.set_value(cdt, cdn, 'custom_style', '');\n        frappe.model.set_value(cdt, cdn, 'custom_colour', '');\n        frappe.model.set_value(cdt, cdn, 'custom_brand', '');\n    }\n});\n\n// Parent form events for Sales Order\nfrappe.ui.form.on('Sales Order', {\n    // Set up field properties when form loads\n    refresh: function(frm) {\n        // Make custom_style, custom_colour, and custom_brand fields read-only in child table\n        if (frm.fields_dict['items'] && frm.fields_dict['items'].grid) {\n            try {\n                frm.fields_dict['items'].grid.get_field('custom_style').df.read_only = 1;\n                frm.fields_dict['items'].grid.get_field('custom_colour').df.read_only = 1;\n                frm.fields_dict['items'].grid.get_field('custom_brand').df.read_only = 1;\n            } catch (e) {\n                // Handle case where fields might not exist yet\n                console.log('Custom fields not found: ' + e.message);\n            }\n        }\n        frm.refresh_field('items');\n    }\n});",
  "view": "Form"
 }
]